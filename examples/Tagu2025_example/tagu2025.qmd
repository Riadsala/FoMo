---
title: "Brief Analysis of Tagu's 2025 Data"
author: "A Clarke"
format: pdf
editor: visual
---

First, we need to get set up:

```{r, message = FALSE, warning = FALSE}
library(tidyverse)
library(cmdstanr)
library(patchwork)

source("../../functions/import_data.R")
source("../../functions/post_functions.R")
source("../../functions/plot_model.R")

knitr::opts_chunk$set(echo = TRUE,
                      dev = "ragg_png",
                      dpi = 400)

```

# Import

## Loading Data

```{r, message = FALSE}
d <- import_data("tagu2025")

summary(d$found)

summary(d$stim)
```

## Loading Model

The model was previously run and saved

```{r, warning = FALSE}
m <- readRDS("../1_fit_models/scratch/models/tagu2025all1_0.model")

m$summary()
```

Now extract posterior samples and predictions.

```{r, cache = TRUE}
pred <- extract_pred(m, d)
post <- extract_post(m, d)
```

# Accuracy

```{r, warning = FALSE, cache = TRUE}
acc <- summarise_acc(pred)
plot_model_accuracy(acc)
```

Looks like the model does a pretty good job of predicting which item will be selected next in all three conditions.

# Posterior Distributions

## Parameter Estimates

```{r}
plot_model_fixed(post) + theme_bw()
```


## Differences between Conditions

```{r}

# are there differences between conditions?
post$fixed %>% 
  pivot_longer(-c(.draw, condition), names_to = "param") %>%
  pivot_wider(names_from = "condition") %>%
  group_by(.draw, param) %>%
  mutate(negative = negative - neutral,
         positive = positive - neutral,
         .keep = "none") %>%
  pivot_longer(c(negative, positive), names_to = "comparison") %>%
  ggplot(aes(value, fill = comparison)) + 
  geom_density(alpha = 0.6) + 
  geom_vline(xintercept = 0, linetype = 2) + 
  facet_wrap(~param, scales = "free")
```


## Individual Differences
  
```{r}
plot_model_random(post)
```




